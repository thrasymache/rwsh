<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>




  
  
  
  
  <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">




  
  
  
  
  <title>Built-in commands</title>
</head>


<body>




Builtins take a fixed number of arguments, and will fail having set
ERRNO to ARGS if they are passed a different number.
Builtins&nbsp;either return nonzero on error or set ERRNO in the case
of other failures, rather than printing any diagnostic text. They are
not intended to regularly be useful as something to run from the
command line. Instead they are intended to be useful building blocks
for shell functions.<br>



<br>



<h3>%autofunction</h3>




%autofunction searches for files in $PATH with the same name as its
argument. If one is found, then it is inserted into the executable map
with the remaining arguments as its argument script. This is a hack so
that rwsh can be usable while I get around to implementing command
substitution. There will be a much better way to do this once that is
done.<br>




<h3>%cd</h3>



The %cd changes the current working directory to the path given as its
argument. If successful it sets CWD to the argument that was passed to
it. It returns the value returned by chdir.
<h3>%echo</h3>




The %echo command prints its arguments separated by a single space. It
does not append a newline. An echo function that prints its arguments
followed by a newline can easily be created from the %echo builtin and
the %newline builtin.<br>




<h3>%exit</h3>




%exit causes the shell to exit before the next command is requested
from the user. It does not terminate any function (i.e. commands after
%exit in a function will be run). After any enclosing functions
complete, rwsh.shutdown will be run before the shell actually
terminates.<br>




<h3>%if</h3>



%if executes its arguments as a command, and then runs its argument
function&nbsp;if it has one and if the command returned 0. It is a
syntax error for %if to follow another %if, %else_if, or %else_if_not,
unless there is an %else between them. It is not a syntax error for %if
to have no argfunction. %if returns -1 on a syntax error, the return
value of its argfunction if it is run, and 0 otherwise. It sets IF_TEST
to true if its arguments returned 0, and to false otherwise.<br>



<h3>%if_errno</h3>

%if_errno takes no arguments. &nbsp;It runs its argument function if the variable ERRNO is not the empty string.
<h3>%else_if</h3>



%else_if returns 0 immediately if IF_TEST is true. Otherwise it runs
its arguments, setting IF_TEST to true, and running any argfunction if
they return 0. It is a syntax error for %else_if to occur except
between %if and %else.<br>




<h3>%else_if_not</h3>



%else_if_not is identical to %else_if except that it sets IF_TEST to
true and runs its argfunction only if the result of running its
arguments returns nonzero.<br>



<h3>%else</h3>



%else does not take any arguments, it runs its argfunction if IF_TEST
is false, and then sets IF_TEST to the empty string. It is a syntax
error for %else to occur except following %if and zero or more %else_if
or %else_if_not commands, or for a sequence of those commands to occur
without a %else.
<h3>%function</h3>




%function inserts its argument function into the executable map. The first argument is used as the name for the new function.<br>




<h3>%importenv</h3>




%importenv causes the environment that rwsh was run in to be imported into the variable map.<br>




<h3>%internal_errors</h3>


%internal_errors takes no arguments. It prints a list of those internal
functions which are run whether they exist or not (and will thus result
in rwsh.executable_not_found errors if they do not exist). Except for
rwsh.init they are all reporting errors themselves.
<h3>%internal_features</h3>


%internal_features takes no arguments. It prints a list of those internal functions which are run only if they exist.
<h3>%internal_vars</h3>


%internal_vars takes no arguments. It prints a list of those variables
that are written by the shell itself or affect the running of builtins.
<h3>%ls</h3>




As it currently stands, %ls is a very stripped-down version of the
standard ls. Selection write and read work just as well with external
commands as with built-ins, so feel free to define the function ls to
use /bin/ls rather than %ls.<br>




<h3>%newline</h3>




%newline prints a newline character<br>




<br>




<h3>%nop</h3>



%nop ignores its arguments, and leaves $? unchanged<br>



<h3>%printenv</h3>




%printenv prints out the entire variable map if given no arguments. If
it is given an argument, then it prints out the value of that variable.<br>




<h3>%return</h3>



%return takes one argument, which it converts to an integer, and then
returns that value. It has more error conditions than any other builtin.<br>



<h3>%set</h3>




%set writes a variable to the variable map. the first argument is the
name of the variable, its second and any additional arguments are the value of the
variable.<br>




<h3>%selection_set</h3>




%selection_set is described in the selection document. Briefly, it is a
variant of %set, that treats the current value of the variable as a
path that should be modified by the second argument.<br>



<br>




<br>




<h3>%source</h3>



%source attempts to run its first argument as a shell script. The
remaining arguments are passed to that shell script as its arguments.
Before the script is run, rwsh.before_script is run with the same
arguments as the script and after the script completes
rwsh.after_script is run with the same arguments again. The script is
run with all of the internal functions that apply to the command line.
(this will change in a future version.) %source returns the value
returned by the script it ran.
<h3>%test_equal</h3>



%test_equal takes two arguments. It returns 0 if those two arguments are the same string
<h3>%test_not_empty</h3>



%test_not_empty takes one argument. It returns 0 if that argument is not the empty string.
<h3>%which</h3>




%which prints the value stored in the executable map at the name given
in its first argument. Functions are printed by giving the command that
would create that function. Built-ins just print their name. Executable
files are added to the executable map when they are run. If an
executable file has been run, then %which will print the name of the
file, otherwise it will inform you that it is not in the executable
map, whether or not the file exists and is executable.
rwsh.mapped_argfunction and rwsh.argfunction are both recognized as
names for whatever argument function might have been passed to %which,
and are printed with just their enclosing braces.<br>




<h3>%while</h3>
%while runs its arguments as a command, and for each time that they
return 0, it runs its argument function. &nbsp;Note: a loop of the form
"%while %return $X {...}" will either run its argument function
infinitely or not at all. &nbsp;$X is interpretted once, before the
statement is run, and however the argument function might change the
value of X, it cannot change the value that it used to have.
<h3>%version</h3>




%version prints out the version of rwsh that is currently running<br>



<h3>%version_compatible</h3>



%version_compatible takes one argument, and returns 0 if that argument is an rwsh version number compatible with this one.
<h3>%version_available</h3>



%version_available takes no arguments, and prints out a list of those that would return true if passed to %version_compatible.
</body>
</html>
